---
title: "Два факта за дизайна на пазара на електрическата енергия "
subtitle: "В контекста на дълбоката декарбонизация и устойчивост"
author: "доц. д-р Виктор Аврамов"
date: "3/26/2025"
format:
  revealjs:
    slideNumber: true
    theme: default
    scrollable: true
    incremental: true
    plugins: ["zoom"]
---

## Основни акценти

-   **Въпроси:**
    -   Традиционен пазарен дизайн vs пазарен дизайн при дълбока декарбонизация.
    -   Има ли устойчиви елементи на стария пазарен дизайн или новите технологии ще разрушат сегашния режим?
-   **Цел:**
    -   Да се илюстрира (с един сценарий) как нарастващият дял на ВЕИ влияе върху пазарните цени и структура.

    -   Да се покаже как цените на газа и електричеството остават тясно обвързани. 
    
-   **Изводи и дискусия:**

    -   Фактите показват, че ролята на производителите от управляеми мощности се запазва днес: в преходния период,

    -   един допълнителен въпрос: можем ли надеждно да прогнозираме дългосрочно цената на електрическата енергия?
    
---

## Дълбока декарбонизация и принципи на пазарния дизайн

-   **1. Промяна в пазарната структура:**
    -   "Традиционния режим" → доминиран от фосилни мощности, които са управляеми.
    -   В новият режим все по-големият дял ВЕИ с близки до нулеви пределни разходи → изместване на кривата на предлагане надясно.
    -   Поява на нови участници (малки производители, мощности за съхранение) → по-голяма фрагментация.
    -   "Либерализацията": цената трябва да бъде близка до пределните разходи → комплексен пазарен дизайн.
-   **2. Въздействие върху цените:**
    -   Повече часове с ниски, нулеви или отрицателни цени (при наличието на субсидии за производство от ВЕИ).
    -   Проблем с „missing money“ за конвенционалните мощности (т.е. те не могат да покрият разходите си при дълги периоди на ниска борсова цена).
    -   Потребност от балансиране → зависимост от производството от управляеми мощности (въглищни централи или природен газ), когато производстото от ВЕИ е минимално.

---

## Изместване на кривата на предлагане

-   **Теоретична рамка:**
    -   търсим **равновесие на Неш** като комбинация от най-добрите стратегии за всеки пазарен участник $i$, $s_i^*$ като отговор на оптималните стратегии на останалите участници $s_{(j\neq i)}^*$. Формално, за всеки пазарен участник $i=1,\dots,n$ $s_i^*$ са множеството от всички възможни стратегии $s_i \in S_i$ и всяка комбинация от стратегии $\{s_i^*\}_{i=1}^n$ е **равновесие на Неш**, когато:
    
:::{.fragment}
$$
\Pi_i(s_i^*, s_{(j\neq i)}^*) \,\ge\, \Pi_i(s_i, s_{(j\neq i)}^*),
\quad (1)
$$
:::

- където $\Pi_i$ е печалбата за производител $i$.

-   **Модел на Курно, следвайки Baldick (2010):**
    -   цената се дефинира като:

:::{.fragment}
$$
p^* \;=\; \frac{N \;+\; \sum_{k=1}^{n} \frac{a_i}{(\,b_i + \tfrac{1}{\gamma}\,)}}{\gamma \;+\; \sum_{k=1}^{n} \frac{1}{(\,b_i + \tfrac{1}{\gamma}\,)}},
\quad (2)
$$
:::

 - където $N(t)$ е функцията на кривата на продължителността на търсенето, $p$ е цената, $t$ – времеви интервал, $\alpha_i$ е пресечната точка на функцията на пределните разходи, $b_i$ е нейният наклон (в разглеждания пример пълните разходи се дефинират с квадратна функция), а $\gamma$ е наклонът на функцията на търсенето $D(p,t)$, като $D(p,t)$ е линейна спрямо $\gamma$.

- Равновесните количества са:

:::{.fragment}
$$
Q_i^* \;=\; \frac{p^* \;-\; a_i}{\,b_i + \tfrac{1}{\gamma}\,}.
$$ 
:::

 - **Равновесие на функции на предлагане, следвайки Baldick (2004):**

 -   Всеки пазар участник формулира пазарно предложение за цени и количества, което има формата:

:::{.fragment}
$$
\forall i,\; q_i(p) \;=\; \beta\,\bigl(p - \alpha_i\bigr),
\quad (4)
$$
:::

 - където $\beta$ е наклонът, $p$ – пазарната цена, а $\alpha_i$ тук са производствените разходи за мегаватчас.

- Търсим вектор 

:::{.fragment}
$$
\beta=\begin{pmatrix}\beta_1\\.\\.\\.\\\beta_n\end{pmatrix}
$$
:::


 - Пазарната цена е:

:::{.fragment}
$$
p(t) \;=\; \frac{\,N(t) + \sum a_i\,\beta_i\,}{\sum \beta_i + \gamma}.
$$
:::

---

## Моделиране I

-   Нека имаме пазар с три „традиционни“ пазарни участника с пределни разходи, различни от нула: АЕЦ и трите големи термични централи;

-   с капацитет съответно 2000, 670, 1200, 900 MW и разходи съответно 65,47 лв./MWh за първата и 276 лв./MWh за останалите три;

-   добавяме още един производител с пределни разходи = 0,1 лв./MWh и капацитет 1000 MW;

-   $N(t) = 4000$;

-   три нива на $\gamma$: 0,5, 1 и 2.

<br>

-   При моделирането тук $\alpha_i$ **не** се изчисляват както в [Аврамов (2020; 2021)](#), а се използват пълните разходи според **Решение на КЕВР № Ц-17 от 30.06.2024 г.** за утвърждаване на цени в сектор „Електроенергетика“ от 01.07.2024 г. Заедно с това $b_i = \frac{1}{\alpha_i}$.

---

## Моделиране II: псевдо-код

<br>

:::{.fragment}
### Псевдо-код за модела на Курно:
:::

:::{.fragment}
``` python
# Параметри на модела:
# a: пресечна точка на функцията на пределните разходи
# e: наклона на пределните разходи
# gamma: наклон на функцията на търсенето от цената
# N: пресечна точка на функцията на продължителността на търсенето
a = [0.1, 65.5, 276, 276, 276]
e = [0.00001, 0.015, 0.004, 0.004, 0.004]
gamma = 2
N = 4000

# Дефинираме капацитетите на производителите
Q_max = [1000, 2000, 670, 1200, 900]

# Изчисляваме равновесната цена p (без ограничение на капацитета)
p = (N + sum(a[i] / (e[i] + 1/gamma) for i in range(len(a)))) / \
    (gamma + sum(1 / (e[i] + 1/gamma) for i in range(len(e))))

# Курно количества q_i (без ограничение)
q = [(p - a[i]) / (e[i] + 1/gamma) for i in range(len(a))]

# Проверяваме ограничението Q_max
q_constrained = [min(q[i], Q_max[i]) for i in range(len(q))]

# Ако някое q_i се ограничи, преизчисляваме p_constrained
if q == q_constrained:
    # Ако няма активни ограничения
    p_constrained = p
else:
    p_constrained = ...  

# Изчисляваме пределни разходи MC и приходи

MC_constrained = [a[i] + e[i] * q_constrained[i] for i in range(len(a))]
markup_constrained = [p_constrained - MC_constrained[i] for i in range(len(a))]

# Показваме резултатите
print("Constrained Cournot Quantities:", q_constrained)
print("Constrained Equilibrium Price:", p_constrained)
```
:::

<br>

:::{.fragment}
### Псевдо-код за модела на функции на предлагане
:::

:::{.fragment}
``` python
# Дефинираме функция g, която използваме при намирането на равновесие в модела за SFE
def g(beta, e, gamma):
    # Събираме всички β_j ≠ i
    betajnoti = sum(beta) - beta
    # Получаваме:
    return beta - (1 - e * beta) * (gamma + betajnoti)

# Параметри на модела:
# a: пресечна точка на функцията на пределните разходи
# e: наклона на пределните разходи
# gamma: наклон на функцията на търсенето от цената
# N: пресечна точка на функцията на продължителността на търсенето
a = [0.1, 65.5, 276, 276, 276]
e = [0.00001, 0.015, 0.004, 0.004, 0.004]
gamma = 1
N = 4000

# Максимални капацитети за всяка фирма
Q_max = [1000, 2000, 670, 1200, 900]

# Начално приближение за търсенето на β
beta0 = [1.0 / x for x in e]

# Решаваме системата за β 
beta = fsolve(g, beta0, (e, gamma))

# Изчисляваме цената и количествата в афинното SFE (Supply Function Equilibrium)
p_equil = (N + sum([beta[i] * a[i] for i in range(len(a))])) / \
          (gamma + sum(beta))

q_equil = [beta[i] * (p_equil - a[i]) for i in range(len(a))]

# Налагаме неотрицателност и ограничение на капацитета
q_equil = [max(q_equil[i], 0) for i in range(len(q_equil))]
q_equil_constrained = [min(q_equil[i], Q_max[i]) for i in range(len(q_equil))]

# Преизчисляваме цената, ако има активни ограничения
p_equil_constrained = (N + sum([beta[i] * a[i] for i in range(len(a))])) / \
                     (gamma + sum(beta))

# Показваме резултатите
print("Constrained Equilibrium Quantities q_i:", q_equil_constrained)
print("Constrained Equilibrium Price p:", p_equil_constrained)
```
:::

---

## Резултати

<br>

- **Симулация по модел на Курно**


:::{.fragment}
| $\gamma$ |  $P$ | $q_0$ | $q_1$ | $q_2$ | $q_3$ | $q_4$ | $s(P)$ |
|----------|-----:|------:|------:|------:|------:|------:|-------:|
| 0,5      | 1485 |   743 |   705 |   603 |   603 |   603 |   2515 |
| 1        |  819 |   818 |   742 |   540 |   540 |   540 |   2363 |
| 2        |  485 |   970 |   815 |   415 |   415 |   415 |   2060 |
:::
<br><br>

- **Симулация на конкуренция с функции на предлагане**


:::{.fragment}
| $\gamma$ | $P$ | $q_0$ | $q_1$ | $q_2$ | $q_3$ | $q_4$ | $s(P)$ |
|----------|----:|------:|------:|------:|------:|------:|-------:|
| 0,5      | 132 |  1000 |  2000 |     0 |     0 |     0 |   3000 |
| 1        | 131 |  1000 |  2000 |     0 |     0 |     0 |   3000 |
| 2        | 131 |  1000 |  2000 |     0 |     0 |     0 |   3000 |
:::

---

## Илюстрация

```{=html}
<!-- 1) Use a <div> to host the interactive plot -->
<div id="myPlot" style="width:800px; height:600px;"></div>

<!-- 2) Load Plotly -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<script>
  // JS logic for your piecewise supply function:
  let a    = [0.1, 65.5, 276, 276, 276];
  let beta = [675.98072905, 63.39828532, 205.39434745, 205.39434745, 205.39434745];
  let Qmax = [1000, 2000, 670, 1200, 900];
  let pTarget = 131;

  function firmSupply(p, a_i, beta_i, Qmax_i) {
    let p_i_cap = a_i + (Qmax_i / beta_i);
    if (p < a_i) return 0;
    else if (p < p_i_cap) return beta_i * (p - a_i);
    else return Qmax_i;
  }

  function totalSupply(p) {
    let sumQ = 0;
    for (let i = 0; i < a.length; i++) {
      sumQ += firmSupply(p, a[i], beta[i], Qmax[i]);
    }
    return sumQ;
  }

  let N = 500;
  let breakpoints = [];
  for (let i = 0; i < a.length; i++) {
    breakpoints.push(a[i]);
    breakpoints.push(a[i] + Qmax[i] / beta[i]);
  }
  let pMax = Math.max(...breakpoints) * 1.1;
  
  let pValues = [];
  let qValues = [];
  for (let i = 0; i <= N; i++) {
    let pCurrent = i * (pMax / N);
    pValues.push(pCurrent);
    qValues.push(totalSupply(pCurrent));
  }

  let supplyTrace = {
    x: qValues,
    y: pValues,
    mode: 'lines',
    name: 'Общо предлагане',
    line: {color: 'grey'}
  };

  let maxQ = Math.max(...qValues) * 1.05;
  let lineX = [0, maxQ];
  let lineY = [pTarget, pTarget];
  let targetLine = {
    x: lineX,
    y: lineY,
    mode: 'lines',
    name: 'p=' + pTarget,
    line: { dash: 'dash', color: 'grey' }
  };

  let layout = {
    title: 'Пазарно предлагане при цена 131 лв./MWh',
    xaxis: { title: 'Общо предлагане Σ qᵢ(p)', rangemode: 'tozero' },
    yaxis: { title: 'Пазарна цена (p)', rangemode: 'tozero' },
    hovermode: 'closest'
  };

  Plotly.newPlot('myPlot', [supplyTrace, targetLine], layout);
</script>
```


---

## Изводи от симулациите:

-   Соларните и вятърни централи заменят мощности с по-високи променливи разходи, гъвкав и управляем капацитет извън пазара.
-   При определени параметри на търсенето това може напълно да изведе от пазара термичните централи.

---

## Взаимовръзка между цените на газа и електроенергията

-   **Линейна регресия, включвайки данни за два пазара (България, Германия/Люксембург):**
    -   R² \~ 0,95 → много силна линейна зависимост (за България е 0,945, а за Германия-Люксембург е 0,950).
    -   +1 EUR/MWh газ → \~1,67–1,69 EUR/MWh увеличение на цената на електрическата енергия.
    
-   **Следствия:**
    -   Европейската комисия признава, че разходите за енергия са нараснали до 604 млрд. евро през 2022 спрямо 163 млрд. в 2020.
    -   За индустриалните потребители, за периода между първото полугодие на 2020 и първото полугодие на 2023 цените нарастват със 72% с данъци и такси и 137% без всякакво облагане.
    -   За битовите потребители съответното нарастване е с 38% и 89%.

## Взаимовръзка между цените на газа и електроенергията - илюстрация

![](output2.png){width="60%"}

---

## Взаимовръзка между борсовите цени на електрическата енергия

Винаги може да бъде казано [повече](https://vavramov.shinyapps.io/PowerMarketData/).

---

## Основни изводи

1.  **Силата на връзката между цените на електричеството и природния газ:**
    -   Породена от механизъма за формиране на цената на пазара ден напред.\
    -   Нкрая на деня, тези производители, чието производство могат да се управлява от системния оператор, остават от решаващо значение за балансиране на системата и, като следствие, определят нивото на цените на едро.

---

## Литература (извадка)

-   **Avramov, V.** (2020; 2021)\
    *Моделиране на конкуренцията на борсовия пазар*; *Либерализираният пазар на електроенергия*.\
-   **Baldick, R.** (2010) *Market Power*, Univ. of Texas at Austin.\
-   **Glachant, J.-M. et al.** (2021)\
    *Handbook on Electricity Markets*.\
-   **Hogan, W.** (2022) *Electricity Market Design and Zero-Marginal Cost Generation*.\
-   **Newbery, D. et al.** (2018) *Market Design for a High-Renewables European Electricity System*.\
-   **Pollitt, M. et al.** (2024) *Recommendations for a Future-Proof Electricity Market Design in Europe*.\
-   И др. (ЕК, Евростат, национални регулации и пр.)

---

## Благодаря за вниманието!

*Въпроси и дискусия*
